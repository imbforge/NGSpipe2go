# scRNA-Seq pipelines

Here we forge the tools to analyze single cell RNA-Seq experiments. The analysis workflow is based on the Bioconductor packages [*scater*](https://bioconductor.org/packages/devel/bioc/vignettes/scater/inst/doc/overview.html) and [*scran*](https://bioconductor.org/packages/devel/bioc/vignettes/scran/inst/doc/scran.html) as well as the Bioconductor workflows by Lun ATL, McCarthy DJ, & Marioni JC [*A step-by-step workflow for low-level analysis of single-cell RNA-seq data.*](http://doi.org/10.12688/f1000research.9501.1) F1000Res. 2016 Aug 31 [revised 2016 Oct 31];5:2122 and Amezquita RA, Lun ATL et al. [*Orchestrating Single-Cell Analysis with Bioconductor*](https://osca.bioconductor.org/index.html) Nat Methods. 2020 Feb;17(2):137-145.

## Implemented protocols
- 10X Genomics: droplet-based scRNA-Seq by 10X Genomics. For this pipeline, input fastq-files must follow the bcl2fastq naming convention (*[Sample Name]_S1_L00[Lane Number]_[Read Type]_001.fastq.gz*, with *Read_Type* being one of R1, R2, I1, I2).
- MARS-Seq (massively parallel single-cell RNA-sequencing): Plate-based with unique molecular identifiers (UMIs). The protocol is based on the publications of Jaitin DA, et al. (2014). *Massively parallel single-cell RNA-seq for marker-free decomposition of tissues into cell types.* Science (New York, N.Y.), 343(6172), 776–779. https://doi.org/10.1126/science.1247651 and Keren-Shaul H., et al. (2019). *MARS-seq2.0: an experimental and analytical pipeline for indexed sorting combined with single-cell RNA sequencing.* Nature Protocols. https://doi.org/10.1038/s41596-019-0164-4. The MARS-Seq library preparation protocol is given [here](https://github.com/imbforge/NGSpipe2go/blob/master/resources/MARS-Seq_protocol_Step-by-Step_MML.pdf). The sequencing reads are demultiplexed according to the respective pool barcodes before they are used as input for the analysis pipeline, resulting in one (pair of) fastq file(s) per cell pool. The demultiplexing by cell barcode is done in later downstream processing. For this pipeline, input fastq-files must be names as follows: *[Sample Pool Name].[Read Type].fastq.gz*, with *Read_Type* being one of R1, R2.
- Smart-seq2: Plate-based scRNA-Seq with reads. Libraries are generated using the [Smart-seq2 kit](http://www.nature.com/nmeth/journal/v10/n11/full/nmeth.2639.html). The sequencing reads are demultiplexed by cell barcode resulting in one (pair of) fastq file(s) per cell. For this pipeline, input fastq-files must be names as follows: *[Sample Name].[Read Type].fastq.gz*, with *Read_Type* being one of R1, R2.

## Pipeline Workflow
All analysis steps are illustrated in the pipeline flowchart ([droplet-based](https://viewer.diagrams.net/?highlight=0000ff&edit=_blank&layers=1&nav=1&title=NGSpipe2go_10X_scRNA-Seq.drawio#R7R1bc5s689d4pn2wh5ux%2FZikcS%2FTpj1JzrQ9LxkMsk2DgQB24vz6TyskrgJjGzBuviQzASGELqu976onX61ePnqau%2FzmGMjqSYLx0pM%2F9CRJVCSpB3%2BCsQ1LRiotWHimQSvFBXfmK6KFAi1dmwbyUxUDx7EC000X6o5tIz1IlWme5zynq80dK%2F1VV1ugXMGdrln50p%2BmESxpqahO4gefkLlY0k%2BPpVH4YKbpjwvPWdv0e7Zjo%2FDJSmPN0DH6S81wnhNF8nVPvvIcJwivVi9XyIJpZTMWvjcteBp12UN2UOWFT8KX%2BfJmHFib5e3s5tPd9OH1U58twEaz1nQuepJq4QYvDXMDs2uZC5s8UJ%2FW0NVLj0xDdIuvFvQ%2FeW3mZUtwl0hbrJRMRrBlc78MVha%2BEvEzS5sh6zKa0ivHcjxSSZ6SH1zFDzznMVokPImXc8cOKESJKvRb85fIoC2SdqK7uWlZiUYR%2BYkaZU%2FIGsqXurMydXwr4OuFpfk%2BvY7WUSDtB1pgOjBD%2FYkQDS%2B5KnShNsgL0EuiiK7SR%2BSsUOBtcRX6dDxUw1foZuqPKRQ%2BJ0BzRMuWCahUBJluCbodFlHbMVzgCwoafDDZ6Df%2F3P1cf1l%2FeP3v%2FvP99Le%2F%2Ba8vvmk4uVbhtwhOFp5mmHi1DwGfGqBFGgspaIlwagJaFIEDLSqreAy0vP4MPtwLv%2F77Mr299laicf9x%2B7k%2FFHOLhwyMb%2Bmt4wVLZ%2BHYmnUdlyZWACYmrvPVcVy6LH9QEGzpEmrrwMFFCaBAL2bwC14fDOnd78STDy%2B0ZXKzZTc2Hm%2FiJbj9nXwWv0bu4veMCyA7%2BFaHtYWVhsKpabHu5AEwBXCFK%2B87a09HJXuR7vFA8xYoKKtHK8LUlwKShyyMwzZpUsgDCvIqHre2TVRwHdMO%2FETLP6Aghk9lPEzDp6SkyVSm%2FnA8LquPL8IexOAZDaUSxH6%2F%2F%2F74Zzl%2BePp1H0jTh5ufojrrj88FYPNQdSgI1wqA3ElVGoG%2FHMDIIzENMGM13UTYUfpWDElHA7IilAJyrl%2Fp%2BvsC8r8%2B8r7P%2FgD3KwmEAPLIcAzBjO4C2ev7BAYvcAVRdV%2BKiTJUrtSKwm3lSupd5NpizD6rLZbwBIePIED2r4FrusgybTTAfIGz2SYYixmH2Qg7GHf9svBhAYOy38Tzp6yWie%2BTbWYG2gy%2FjTc1nQYQyNDctE3CoUrCuxk8eV%2FKgZ3duC1HM3yCRXwXbw7AI1gsg4GCEOYYawsLln%2FB%2BJDvY0xtakDLNCxussH1YdjmHHMgBJtrGIMg76AB1wCDL0hfBzDfCRgs6AlgRlzhkTH3AYj6F4AepenCDDCGG3iWO7AxiZGm5mo2dzAWx5c3H%2B%2BgbWnh4Js%2BbG3LmQGu1Hwy8Cn7Mu7F1Ndvby589IQv%2BQhC2iX5yAmCQDkJvkzSACuvcjh5xrQnOXlR2Z%2BTx7cJirKHKKhwBMEM74RFHBcusQjkYmEI5iNkhRjfMmYFkU5F4c5gGftRfVrF3CxKnElkZUdyI30pzSWM0g0487mPgty67MfC8kX04Sl5WHb9O8XP7hK6UvxqzL4WcKx53vdwHlaUqkpRdTOxBfvxUPZu5rwAajbtRYicZ45nIK%2BPi%2FENmSIG%2BAR1CxjKh9GTpPYSHoNOTIHfqIarGUbUtlRG6TTYTx6ap3rXAlonC%2BgPgheOrin9kNEhraWuG2gDavI9ey7oVFkUF2LA7wfe2ta1AO9VzgoIib%2FiYfKpPmMa86BVDDdZhgCt0iPAUO27mk4AJ9GgkKsVgVeillQMY8HMMba5whwbGxisxNdWrhXxIFyGN66cf52VmNn2MCoGZmxuplgts1LzUJjvcskg5madQwhbE2zMKLY8DsA0bn0Doc0JoH5b2CtkB80PwUOuZcI2rG8YiSaBwAO6DpYmiGup%2BWpuTIPBoL7RaDYQQydYAkAJhhZoZQOo%2BD3ukKCQhw4IZiUoLSlplLNOUimTD5wmXiHrgpo4AuCNLpnBw0Jz%2BIyDa80tohGeEyVwkkt6XpoBusMYEVp89jQ36tdx8oKUUXzl5QVJ4MkLjEdtQ16QTqpbPTe%2BlC3p2fClLpd1WOHuYxxGuAPBjVnRsLxPdhA8UxPPMNAHfbqrLgh%2FYIeajGJlYVjwI1Z38RQgOdUfF%2Bu42bJlrtZBQw3RAzwc87nnywTXdiIeOlItDTaa58fK00xfi6p1jK%2FeOZpGOewcHDUDNRmy63rOBrNyGTUhbzeU0uDLSKt4g18cLJGGZUkmGhZ%2BMnwDhsnVRArvHDcYvK%2FaB95M7qTgUjkFP5ZWU2HmK3m9NsN9mnor4qgi9T7Ay%2BNw6s20bSdT97EPdlbfp6SXsQF9H9e6Kspvj6%2Bqy4OisguF2hEuK%2BJhppiU%2F3NFUHIVBudpjVFfAD3UHTy3DkCVM4cOa8%2Bk28S21JgpJjK%2FQVWwAOEHTzqjKxWML%2BXWFx7iyaD6NOaW1QIET3zDaMNCGuJrwPRDIePSouRRvahycJTajF2H67QlTkrxCbJmznMLqEQqxyXN4QSlIk4YCnXjhAO9UdK2QkU9yrukGoxEs%2Fm2YaRpj6ahmFlbOWNFrM2jKf0deTSqFYa4fEuHzJQ74KiIb5FPxrdUxVFKV1w%2FszhKSsLXbnhUhs3Do3g2zsp16hmrg1JbLHButVTVU%2F%2FMl%2B7qUVvKxotjPt7IfbU72GNfItTCYsmTTuz7kZzZ92m6srt%2BzS7fd5uL54%2FinfPw%2FXLy%2FV%2F55cdy9djvkPj899KhUSfg8Vg6NBwfRYcqC%2FfwiqfZC%2BQ96BjSgspi%2Fi0WqIny2HXBm4I5iJJGSEELEn5CA69nxrGHwK8kVrFJgb9mx81J2tVfObGAz59bynknVLmi8AsmGFaufwdLJ8S2tAxyBOtcYrapcS6tOYHZzBrLV6ZhENyZWZi45JZOh9wrCLAjMZbEpB%2FiNbrdcbeGl%2FgPT%2BEVUOMh7uYVvhfje%2FwH1b3gyrFx05pJVhhh4H1GftDLxwTWAAvyGD6eVvfkgIGr2JeVvYGhGtP0RllctSqVql2jc1SsLes3J9R2ty2RuOZTi6JwgHH9%2Bzpw10CnIISe2v4yVAo%2FfNLL6NLprOmRJdKJhmES6oSH46X6XcXieLwLUBK9sBDkqbYyLYD3T8jaIGi114av0IiRpBIdNBcrHUCiKsL5qGNwLuRA3UP%2B2gr8bgJ7yCLGIA5mdhMwtLXthV6E%2BN96ZUIijTBAijCJBuob69DlENcuDwZr1ZnhzW9JlQUl7NySk6a25LjzW9JyFh3dj7hnfbYXdceyMHsOvkSU9CBNh%2F3IKFS3ALwBYB7KLdIXPtcrnZLrPZWukDGzO7neyckUu6X97gzqyXO9HgJRsqPYp11HUspTTKMpmfpL094%2B%2BLpnaz56eggfYOn%2BAaoS9dAgLBvcrox897OPC10ss%2B6KnR4xqYIfDJbIcpHnD265I%2BdWO5VXbQMDPX%2BH2x94bBgZR0gAUIXnrHqpXAuE%2BA8SPY78XL85hjkHXEqAW6AhWJRF19d%2BAE2p2goIvD3zQ%2F4y9qEFjiLU6AZ44f0lRlJ%2BiIMlwUbIQMkdw4sS6gST0RYXPRlXYzxEqQbOg5%2F%2F6viQlz%2FrlcvqUzVoa96aUWor%2BuE4r1WjVqWGnBby1kaWDI15GQyredfUaOgx7Tny0AvGlCaJW6xq5zEAG6xCbAP6bIITmNd96OdJvDstc%2BZpFJCbtvtEVh8fz1t1S4%2FSlmtns66csnRaS8%2Fj03PwbK5WIpK%2BqobwQ5n1L%2FujcxF8DvUMT2GcPaSnplGLqqZpUc5xL0SCOdSSx1FKOgWoNGrGA3CUAWfW4cJ%2BZT2Zj%2FMYrIww%2FfUM1JcSZkGDrYv8gzAmUZiS3EQkLAkjLuCoti5qGU9mxrIHzhz%2BFThTEU6LM7naIulsPMu6EKasVLWtyh3xAGKgxLSTNMVyoQdQpr6qtIPnEh5A2mLhVUZzUBktwiQSYY4Sn%2FGCWPIEZpOM7uP1N9h2kJ6lFZzH9wmCzu6B9NSzRHpZl6AhQzAnQnp83%2Bc3mJuhLml1VBEDjpvhPffm9MS01Duc7OD0MvWVSTsYcKatrkDfRA5sqIj9dMxPEdQ3Mxc%2FzUWbEY24uzrt7h4obXSWKC3Lxw3VDsq%2Bfz1G667smw6EH4oHy75yqqG2ZF%2FW4a7Jvgtko0vH2GK0KFVGidTZh%2BEmYAY3ROqF1uCDyF6A9aFNwRc%2BDRm7cKeq48qh0PsbcKUy7qBHOGNNOmNzz7v7BJ6mP3bU5B5yGzBk2knq6rMxfUi74IcHA3Xeu60GaM%2Fa4BQOZ9CY8w9XsulQdFf3tTnjyvGFdbMSR7kMsW4fhL4az0p3i4jaRQdq%2BxHZzgpVo9ynx2uhY00YG7SgPcdLGg2H74gzxzLY2sucOUE%2Bsgjmbftr5Dww4mxl1PnCckIHaEDbJNvqrux2ByUtqzEHWQ1oGqonsPRIrOopIdSApvlbOB%2BTlpu4ZtOLRUjk7aYX49tDytMBtRozFhHNHRQ0fQCW2CIFnXDsIXyn5G553U6KY806f%2BBAbByOfEcJJJXLCm8tA344JemAOPzvHYZxvGxhgELoyZhxwWXuiY%2BYlHvv43tM20ly0Sg2KjQzaQTYePnmQi8lDb%2B19U2fzDNy%2FeNzjh%2BTPLxsxv7fsePTrZ9D9vSJmrZwjMR8nLY45pD28eh4bMzVXb%2FNiBWRnVx0ZuJn1O%2BTqM8%2B21UiVrTnzBEMHVKfkWSgvUT86qvpush4X9azVmRFW1uFWVQwDduATEgOTwx1e65mhkQTURamqt99u%2F1H4sOd%2BPBVEMSHW%2FEB%2FxuQ2R4sXktpQWfHIHHHsLvHZ61VzYjrHAeSlqV1ll6sw%2FYCSIGUCofpEMKbaasY3b0Jq0DaiVmeVEyE01xIsHIuDFaRWWDUpl2AubCdIINOLV6eo9F%2BXp4jevR8497sEC15S%2BMrq1r06WoBVxLqsQk%2FgjHPo%2BE82704MhEG1J5fJ4v8hLFUt%2BpPkvBxPlb9rFPnSMlr0Nu06n8SvsyXN%2BPA2ixvZzef7qYPr5%2F6xUb9HHQdd%2BLzV7QALjiG3oKjpmeF9IwmlUssEjcBHJCxTFEuD11h3jkeVKRRei2kLo1JOLwa9%2BTmOkJQuUCQP7YlfSR6L5EvCNqah5yJReSvCgaYw3ZjHTM9Tm9BzhnZ0XHYqeR644Zm%2BhgjtJrliRPKYTbDcSGZa57olAocTwSkxwt2ct73QIZ3HzVhA8AlslDhXdCl7H%2BgYjXoatM%2BWgreb9c8yp2WM7SbUTX9dOdxwm%2FNRFY6GW%2FW4NPZjp3QElUDiZmoae%2F2IccvmHlTpiiM1BCFOWUWTjM0YkydjG6vk05xb0BjlwVOPv%2FDg061IejcNyElcL591jMCoiFNKjE4VGmF38jnAC%2BknvROj80R5LW1T2IuKJjnczXlYLmIech1SOX36EMYHEQUQCh0bTTY4fI83wziilFO%2BnN9LIX34yV6uif4G2e3ML90PPMVj0%2BLvh%2FxGHI9myQnJCj5TSKNJ%2FlN0pha%2B6%2BPecsrtZP5sRbluoWkmvv3xPpyb36%2Bnt3dvThbZ%2Fvl9%2Fd%2F%2B1W13EyFcOpI3sxpOaP0KVk767Owzaa13DQHLlFIfIWsvZXDeR13S9bDf4RPkIS%2FAga%2FhBcbLWTsQgsq75Xpgyyi2chZwz0dHdGq%2BYOw3kDiasCLge7sFODZsLbRiVO5cE92OvFpF3shRHzzg2SBI1rsmo97OhwlcgKCylBn%2Bx5Z3IXP68bOc%2BHF9MJLDdl8q658qW24%2FaXnuk6e1LDf3NKfeOW5U30yL8yyXldSkK89a3sJsbowvl3UMoaO8C4Iw3nlD%2F3JnjNfnbwqIzlzdpQy5nh9yXn6Ko9qsEDwcwQJp91ajR8exR115YjY2o%2BEPmqxupTFrsOnWh635B05XHmYSWM8lpLgs7O%2BpNZ7uDJXM9Ghw74bCWioCkh8zCp1ApCy%2BgF5V2awbP2hdAwgVc%2BNuA40Q3ODynoEVoIlZZuVeWjlbEAbSpoi2lka%2FgYZc5Kq0ORbvTY0DGFCMZ2OkqtJKAa3djUJDrwRwPoPYfMsPM0wcdNMo9uT5EvyWw9XlPW6k0%2Bcd6x0M3fYNz7AMseqq87xUeeEt%2Bcmn06eI0siEwJO5yjP82%2FJzHJiFgjavox8VBJ4YEp%2BuAQ2e%2FZuio1LS19JcxFu9FqF316BbSmLjWgxRoCmTqn9gp5HQyj%2FUjMIFAhpMa8mz9DJKEMteQ6LI461SGZTXvviMvpd6Ly0h%2BsheWttZUusyBD6T9bqSBKwW04YOQ5%2B6z56WiNbD0PuaN46KzyMqGT3W7nIr7jkHnAJae%2BqlzgV%2FaqXPBKdxqWnj8MkEI6v%2FCBt1y37Wm6E2QHq4ZrQMdHv%2FnMVIjmMz0l3DhzqjeOt8OdftVSUYnT%2Bh0D8r6o19dmAWMd5PBM0cN%2F4s%2FaDVZhAmoT642HOYXuG07jRPBPcbkgIp2nr1iAesr7ViduYu9R89L5iPz6QiFUBveBJ9FhfaPKBH1cX4ToG%2Fbub66iP%2F367%2BBHPeqWvXFlrn819aFwyw%2FFv4%2B7761nfddy1xTIF7TOP25D0PUZZF%2BMEcWx2wi5UbPbCtgE5oZ3d2xuGPrAM4SbxBccT7yHfZzAQpW0gaw8eDX2S4InQatoTQPvuvh3AhXnEkfVByNCcvyZgYDLMClEVM%2BbJdYQMcPW6HZLVD1QdNZUMvOnUuYqSVs2ok4wyt3rq3LT2uK3UuazDXUud%2B21tBSamtJVj7NYrjLIJyYwINGoznfgKOvykc4X%2FYmPM2bkRZCV6dcxhik%2BdSVw8qR9Bh3OIcmeLYrDu5nAp63U3M4j%2BSEZy2XNzsfZyjGiHNDjtnscbzgg8gHqD8DbO2plNvcCtxCbsZMfKnmjKMH%2BvrUBkK5wvTo3CyTrVicws0DETkE7OLy4cWOZpByAg8kMvKAiFLaCNjvdoOUQ9ssJi2YIIlon%2B8gSs4mYPKMBSIaEC%2Fh7ffVdfB%2FFEaJg9ApROe8DOkrbWXiq2DDg3EtGMJeZe7HYv%2BLs%2FAlCIJWCkY8LspVVgjg7icWIBK43rfaSk4D2N0xJHYdnR1oteDI%2FZTmUsfkf0CI8IAUzGE%2BNj1gIzc%2F77wY7utQrbDcb8Gp7j3jOWQyjgXetgWKUUvzqUeVGuvFxMzOhef65AnhI3M5O1RQaX8k5vJjIY32K6ESSrYwBbfnMMEECv%2Fwc%3D),  [plate-based](https://viewer.diagrams.net/?highlight=0000ff&edit=_blank&layers=1&nav=1&title=NGSpipe2go_plate-based_scRNA-Seq#R7R1Zc5s699d4pn2wh8XG9mOS1l2mTXOTdHp7XzoYZJuGLYCTuL%2F%2B05HELjC22dx8Se4tCCG0HJ39HA3kK%2Bvlg6e6m6%2BOjsyBJOgvA%2FndQJLEsSQN4E%2FQd7RkqrCCtWforFJccGf8QaxQYKVbQ0d%2BqmLgOGZguOlCzbFtpAWpMtXznOd0tZVjpr%2FqqmuUK7jTVDNf%2BsPQgw0rFZV5%2FOAjMtYb9umZNKUPlqr2sPacrc2%2BZzs2ok8sNWyGjdHfqLrznCiS3w%2FkK89xAnplvVwhE6Y1nDH63qLgadRlD9lBlRc%2BCp9Xm%2BtZYD5tbpfXH%2B8Wv%2F58HIYL8KSaWzYXA0kxcYOXuvEEs2saa5s8UB630NVLj0xDdIuv1uxf8trSy5bgLpG2wlIyGcEunPtNYJn4SsTPTHWJzMtoSq8c0%2FFIJXlBfnAVP%2FCch2iR8CRerhw7YBAlKtBv1d8gnbVI2onuVoZpJhpF5CdqNHxC1lC%2B1BzL0PCtgK%2FXpur77DpaR4G0H6iB4cAMDedCNLzkqrCFekJegF4SRWyVPiDHQoG3w1XY09lEoa%2BwzTScMSh8ToDmlJVtElA5FmS2Jdh2WEdtx3CBLxho8MHkSbv%2B5%2B7H9vP23Z%2F%2F7j%2FdL376T%2F8NxVcNJ%2B8V%2BC2Ck7Wn6gZe7WPApwZokWZCCloinJqAlrHAgRYlrHgKtPz5Eby7F%2F797%2FPi9r1nifr9h92n4UTMLR7SMb5lt44XbJy1Y6vm%2B7g0sQIwMXGdL47jsmX5jYJgx5ZQ3QYOLkoABXoxgn%2Fh9dGE3f1MPHn3wlomN7vwxsbjTbwEtz%2BTz%2BLXyF38nn4BZAffarC2sNJQuDDMsDt5AEwBXOHK%2B87W01DJXmR7PFC9NQrK6rGKMPWlgOQhE%2BOwpzQp5AEFeRWPW90lKriOYQd%2BouUbKIjhczybpOFTGqfJVKb%2BZDYrq48vaA9i8IyGUgliv91%2Fe%2Fi9mf16%2FPc%2BkBa%2Frn%2BIynI4OxeAzUNV84A0ntUNSCfRInkPJYoXMSQ9gPmHPlmGC1xBVNyXYroElSu1Mua2ciUNLi4t1bBhUQwXmQamBrjwMknm6Df20cPKPSkdj%2B%2BqdrZMBVLgoVWq1U0QALd9AasjLdZGgKnsyDPdkY2hQ1oY1nLlYEjBl9cf7mBo0trBN0P839J0lrCWqh8gPIxFOHCMFha%2Bdnt94aNHuLRUL8CXo%2FD5CNNv52mX73xBzeRcLTjsg9rSQHX0BALQKeMUNMYTxIV4bw8Db2traoDRCmdBhcRf8ZihA5w1LwC7LNPVxU4qbaUjWMVL6FcC1eKKPYPKCiNqFCjrhz4%2BBq4Fjw8JvTMCdYnfTmBySdDRyrANIvNJwpslPHlbKtOc3bhNR9V9Qs59F2mEoEsCGSioNRx9awJonf%2F4EN4OdmCowHGoth4NbgjDNlaYpyd8lYrZFsAURwy4Bhh8Qdo2gPlOwGBBT4rl5QbETIUjZYYCZVLKFMc1SJl8tpTDB2amAMvaLlxiWdzFUjkMnvLkIQM9Cwsi5d6YO12ljGjlORRzUyZxZiwsO0wsy8lRQyktd03TDTirlQ%2BEJbMIh8lSfF3RpEthKrz%2BmRKs9kn%2Fg6TsH6sCCqT%2FOoUwUaoqzrckhH33kfdt%2BRu07BhVgqKtmpC1dF4Aoxn2muK0pePpyBviYmANCKfAAJ9gPAFD%2BSR6klSjXxBWQkZj%2BI1quKquR21LPWQY6QL6o%2BCFo%2FRMP%2BwZY1jQ80aZQQ6xDHmtPGgVw02WjiIrPQIM1VgW0gjgJBoUcrUi8ErUkophLFg6%2Bi5XmOP%2BAj0SaFXLNSPSzeUT48r518MSI9seRsXAw6yMFIdiVGoeCvNdLhnEyqhzCLQ1wcb8VeVxVPzqwSMD3OPWNzTWnACa4bVtITvoYlAeck0Dtmp9A0s0CUwAoPRgQ3RdqRlsc5SuWesIWXPCp3cg3tlba4m8t12MC6wLtY%2BKNCq8MTEr1dGwNMesf1i40a1ld7xghNjUNzYBi58LkfwPLoU3GqZ1Hsye8Axf6mSMrlPn8mlUmqCNsh339eL2bniHHkuHV89glqqnOXqNuIONJ2q31dGMRqP6RqLaIEo4wQbIsaCrgdoUtEEhj5kifClhCJPqjXLBU0pIRExSTQihIKdj2mVeME%2BFACTLy9BvwUQr%2BIyDa61MYthdEVtuUsZ83hgBusP8JLT47Klu1K%2FTVCtSSlAXp3nViiTwFAXy5GDpDt8mBLwDpHqpUxPpuUn14ZKejVTvcgUvC3cfc3dEthLcWJCn5UOyg%2BCZkniGgT4Ysl11QaQrm6pPi%2FyAwoKbWMfO07ouK2EdN1u2ydU6aqgUPcDDGV%2F3cJmQeTvSQET67NGT6vmFBquiaj3TSuwdTaP6iRwcNQM1WX7Wc54MwjkkbRO83VBKg0kPiCnjGr842iBVxy8zxVrhJ%2BkbMEyu%2BUN447jB6HCuMzGTeym4VE7BT6XVTBX0hbxem%2F9dmnqPxWk16i0e4ax5PPXmOc20aiwJP9hba8k4vYwNWEu4nmei%2FPr4qrocISt7Qio94bIiHmaBSfk%2FVwQlV2FwHrcY9QU7oukIlQDOCjqsPpNuE4M2dBYT0ocBM%2F%2FWxm9ENn%2Boiv%2B%2Fwg8etZCu7EfrdKEK0ToP8WRQfRpzy0oBgicu3qxhIQ3xNWD6iZDxTB3nUb2ocHCUcrgJvAqm5%2Fpei%2FNSfILMpfPcAiqRynFJczhhXBEnTIS6ccKR3tFpt4qxImSg4jRvZy6MRLP5umGk5qXPe7KLmbWVMz4YFEjZW%2FGinwpD8nRaKwxx%2BZYeOXnsgaMivkXujG%2BpiqPGfYngyOIoKQlf%2B%2BFxPGkeHsWziTmqNYSjMii1xQLnVktRPOX3auNaD%2BpG1l8c4%2BFaHir9wR6HEqEWFkue92LfT%2BXMvk%2FTlf31a47cunu6eP4g3jm%2Fvl3Ov32XX2421sOwR%2BLz30uHpr2Ax1Pp0GR2Eh2qLNzf3V%2FcVhbtb7EQTRTGrgv%2BZ20I8XGcEl75A6T4cWJpmpTia3Zcn4tpqOlYaufPLWOnE%2FpZYgoB3wFcfBObSDLIDqxtiYlmxra0JgQmMmv8tgxdJ7gwsyZxyS2bCXlQEPdOUh8QEz3FU2z74m5NLvEfnr0roK4T3M0rfC%2FG9%2FgPqnvBlWPjplWDLC7CkPqM%2FGCQD9WvAQzkGXw8rb7JwQFXUS%2BPD4aDakzQK2VZlapUp3YNzWlhx0pui1a3DZL4HmYhFI4wln%2FbBu4W6A5ktmG2vAzVwQ8ftTKa0511PLIsOtEwDEKK8HC8VL%2BrWBBPd%2BlJopcwM8hCtQwT4P0jMp8QtDpow%2FdnGlKjEp0yFysdQZ0qwvm0Z3Au5EDdQ%2F7WDPx%2BAruGEXQSxMFsbgCGNncD6i%2BN%2F9laBuS3olGWhAHU0VDfUudqXLs8orRV54RXvyWVMERr75acN7UlZ73fkqaz7ul%2BxD0bhntRc0wTc%2BbgG8RID1I12I8hheoXgDcAzBO5RfrC53qlLrnernR%2FITO7l%2Budd6aoLe13b1BPnuv1EIiSPcU%2B7TqGMp5iEU3Jwt8Y9u6Xr3m26qPHX%2FQBlu5%2FBSToYuFrI1o2urX0fPezjwtdJrPuh70eMamCH4w2yHSR549uuSPnVuvKS7aBgZ6%2FA%2B0NHhtGxhESAFThOdYglbCFEP9RoseR3%2BpXRzdWgEsJcAssIJWx6NrWD6ApRbWAwNtLn%2FKXsU8scBQ0b0iAF97fYCTlUxwsCTZCOkruGF7UTy%2BYjLa46PmsGuMhSjVwHvy0lKeHsPzeWm5Yn6lBW%2FO%2BjDJOsg%2FH6SYbtRI15ISQtx6GOUpDr4FJNW%2BZGg03hr1CHnrBmNIgMdtVbTg6YAOLYhvQZxOcEHrRU79N4q1pGktPZYDcUyPPuC1XzWZdM2WpWyPPw%2BNz8GxYloikL4ou3IyXw8vh9FwEn2M9vVMY5wDpqWnUoihpWpRzxKNIMIda8jhqnM7MLU2b8eibZsA57HBhv7Keyad5AFZGmP52CepLCbOgwc5F%2FlEYkyhMSYIzEmaEERdwVDsXtYwnM2M5AGdO%2FgqcORZ66M4eGl%2F7byM9NpV4rVqmyrbV2l2gT9IJSmfjD9iH4PLKqyz3xG8rRBihDpqdb1Hot5Wpr4xbpWa%2FqAXvQAcu8hLx4AJjAiSyio0MsbWvBYKWzENNB3QAJVPOkpJlXbwmIT7piJLxHdRfYQKNulQQ04oIb9aMQHEw%2By6mVRmT%2BR72PVN%2FPG8H4S1V6wqUiORwrIroTsMYheTcWhrrH8a6zbBT3F2NdfcAlDY9S5SWZc4nSrfMORellYea%2Fp83556ikkRi3FltizWvjCYudP3710%2BXNKvZPd6tAoSvP6Y9QXhYI3kMhaoT4whuaBBaTeI8acxoc0vmBz5AIswJZNNtTvWnt2KpU1L61It2WS08PMzlsREFDun%2FAUhq1j6SypxxtprA7yB%2FnBl%2BtiS%2Fg6wfOH6ikB%2FYyPD9APbNpK68KhmmTpp1y9RxVbp%2FPU%2FXX5VuOl%2FLRDxapSunwawllW7Y4b6pdNfIRpeOvsOMoVSZKfRCGZgxkxhfPxG0Da3BB5G9BqN6m%2Fpc%2BDQklsSdqo6IJ8KgdUTcALc4nnXLLfKVfH%2B9%2FatWdrFysHA%2FlXyK3E8lH%2BbSDtPvYegjudypX1vo3c9SLuU4Wd81jSBoK5IzwYCG4zqA6ewgnjPDJpbxmkX8aTEP2gDTqQjdMp2lWq7e%2BOTmwwECT9UeeuqSSxVXMGTWSaalfzJ8SLPm0%2FO8ex%2F9UgO0Z330xhwlU2PBAVzdR4%2ByOfSfRZhVZhHq5hBOCikIu30U%2Bmo8C%2FUtAh9AWwNi%2FgHZjoWqsQnd4zXKoJDkE3gF8JZ4ISbIdWoQWT%2F9FVKDrZc515J8Yx2s2nbnzjlox8mJmW%2B26dD4SJ8MEWB6TzLro3IU15hyuA6eREoh6alY1ZFaqAFL83dwPltFbuKazSYc4ZDXm02YL2P3yCQT0cyDTDJiiwR0znGk4ccs9isob16ciqL3pzPG3jZRaBmBpHJR4bUdF0inJJ0vA%2F%2FzBsM4XjbqWkRtZpkIvTB66QGTcjgGK7zHtJ2cJRClTqAWNZUAGy%2B9NFVsqPitnW%2F4ZJ6R659%2BxFBTJ1P9v2Onn650DoclzcMsCxE7lE%2FjJM44pH02PR0bc22ArzOgXQyPeT4z6TPqdyfas092lYB29Tlz4lqPtGehZ0aU3uaP4bpIf1vWs1ZkRVu1qPstpmFPIBOCEo%2Bp9lzVoEQTMRamalhui%2F2nJ%2FqKo1txRL1H1n%2F63U%2FpiH6etbo0I4hznIxblsPDPME9NgRAXtNUHHyPUNlStWJE9irU%2FenoRXleMQNmc7mAOo3uqkPfP21T4R8aJztInVmLT8B0ephPwHQ2y4BYQ4E%2FkCblliVWqeoXwFYL%2BA2qoSacBsY8D7rzbA%2FilCQwoBZjfljKFxhLdV%2BAeRI%2BzsfvKWuun47zuvE2zfUfhc%2BrzfUsMJ82t8vrj3eLX38%2BDout9TnoAkLAJXRZxdWYR8%2B%2BoDXwtzH00uZy9GxZSM9YNunEInEzPyddM1hRLgF1YcJpHlSkUXotpC6NSTi82lgs0f%2BfQum4QJA%2Ff3EJm3uQOHYzShQKba0oZ2ISyaqCaeW43VjHTM%2FSWzDcWckdOObMdJjTsvaZPsW6rGR54oTaN5zhuJDMNU9gSmWMSmSiihesc973SIb3EAVgA8AlhjmC9kHX%2BPCT0atBV5uWz1Lwfr2GT%2B60nKFFjCngF9S2U7IdX5vxq3QyXq0pp7cd69DGVAOJmSvp%2BJ8JJ3IidJNMURipIQrTZfp9g5onFk5Gt9dLb7dXoLHLAief%2F%2BFBp9IQdB6aiR4432HYMwKilCaVmBmqtMJv5FOAF1JLup3H5gjy2tYnUWkMzPNJWnOwXMQ85Dqk8Hv0joZPEgUQok6LOhzxALSb53VBnCzKSX%2Buj6XwfrpEz%2FYEf%2BPsF%2BY3jmf8weNTo%2B9HPIZczybJCQnj%2FCaRZvP8JmlMrf3XRwXnldrJxLjrct1CUs39c25%2Bvjc%2BvV%2Fe3b04O2f3%2Bee378OqWu5QhdB1tpfMsZfT9HG3e%2BuHqT2a1nKzwy%2BIQuILHNdROeWL4%2B7IevgP8Aly0gdN0xDxCawwZBdaUHlbhg%2ByiGojZwv3bHREq%2BaPaL2RxNWAFwPd2SnAs4G%2F045zOHKPaO34mLuDECK%2BuSHpn4kWu%2BZzW49HiZxInzLU2b6vFXfh87qx81x4Mb3wUkM236orX2obbn%2FpuU6RHadtbWrpO1557lR35l9Z1utKCvKtZ%2B4uIQgXxrePWsbQQe8CGqcrvxvOD5z56uR1PJUzh8aOOVmIJDlPX%2BVpDRYIfh5Jodut1fipsWVJ0fbLBJ0lNuZ2u0%2BJjXt8PP1pS97MASUHOztNMueXzKQk%2BOytLyknnU5fTTMx6Q84NhKqUBWQ%2BJhV6gUgZfUD8r7ssdn6E%2BkUQKqsT7jaBqquukFlPUJYkszT6CHLeQJtKGmKaGdZYBvLsBM13Hp2R5p0VmOj5GoSisGtXU3C%2FrQ6l%2BS3Hq4o63Un9zE3bbiZe%2BwbH2CZw%2Bqrc3zUOeH1ucmns%2BLIkhgKAd05yvP8WzKznJgFgrYvIx%2BVBB5YkB8ugU1Ot5Jl49LSVyY313sFfgcFtqUsNmLFGAEaGqP2a3YQJaH8G1UnUCCkxbyaPEPn0wy15DksTjnWIjmc8toXN6Tfhc5LB7gekre2ZrbEjAyh%2F2StjuTkJdOhMeHgt%2B6jxy2yNRpMxzJ7mvQU0pLdb%2BYiv%2BKSe8AlpL0rgn9cN7pJHJtBI851NNS3rmloLA0XhnB85Qdpu27Z13IjzA5Qo2vCxsS%2B%2B88VRXIYn5PuHDnUa8ez8Of%2FqKn4w%2BjgP4H4X1Vr6pMOUYyreCZYSL7%2Be%2BsH5HxCFsSPh7mC7Umn8Un1DHC7IcGZhq2Zo3jI2k4jbmPuRvXR24r9eEdiUQX0gifRC%2FvC0grcXF3QdQyGd9fvoz5%2B%2F3pxE896pa9cmVs%2FnHtqXDLo%2BHdx9%2F3tcug67tYMcwAdMo87Svoeory0cea3cHZoFyo2e2HbgJzQ3u4dDEPvjBXJQQVpjejEe8j3QxiIEjKQtQePhiFJ3URoNesJoH330A7gwjziyPogZGjOXxMwMJ9khaiKqfDkOkIGuHrdHsnqR6qOmjowpunk4uNxWjWjzDPK3OrJxdPa47aSi4cd7lty8a9bMzAwpa0cY7e1MMomJDMi0KjNI2cs6PCjxhX%2Bi40xZ%2BdGkEt7O%2BMwxV2ftSB26kfQ4%2BSg3NliGKy%2F2VnKet3P1KA3yUgue2Wst16OEe2RBocm%2BAy%2FACz8xkOr1AdqxJx0RuAB1BvR2zgfZzb1ArdSOGFqlUn8i6YM8%2FeqBSJb4XxxahROVjbFa1vDCQMdMwHp5OTLwoFlnvYAAiI%2F9IICKmwBbXS8B9Mh6hELi2VrIlgm%2BssTsIqbPaIAS4WECvgHfPdNfR3EE6Fi9ghQOusBm0vf3Hqp2DLg3EhEM5aYB7HbveDv%2FwhAIZaAkYYJs5dWgTkaiMeJBaw0rreRkoL3NE44HIVlR1svehFgdpDORfyG6BEeEAKYjCfGR%2BQsCP%2FtaE%2F3WoXtBmN%2Bdc9x70OWQyjgXetgWKUUvzqReVGuvFxModG9%2FiyAPCVuZiZriwwu5Z1eTWQwvsV0I0hWxwC2%2BeroIIC%2B%2Fx8%3D)). Specify desired analysis details for your data in the respective *essential.vars.groovy* file (see below) and run the selected pipeline *tenX.pipeline.groovy*,  *marsseq.pipeline.groovy* or *smartsseq.pipeline.groovy* as described [here](https://gitlab.rlp.net/imbforge/NGSpipe2go/-/blob/master/README.md). The analysis allows further parameter fine-tuning subsequent the initial analysis e.g. for plotting and QC thresholding. Therefore, a customisable *sc.report.Rmd* file will be generated in the output reports folder after running the pipeline. Go through the steps and modify the default settings where appropriate. Subsequently, the *sc.report.Rmd* file can be converted to a final html report using the *knitr* R-package.

### The pipelines includes:
- FastQC, FastQScreen and other tools for rawdata quality control
- optional adapter trimming with Cutadapt
- mapping to the genome using STAR
- generation of bigWig tracks for visualisation of alignment
- quantification with featureCounts (Subread) and UMI-tools (if UMIs are used for deduplication) or cellranger count (for 10X)
- downstream analysis in R using a pre-designed markdown report file (*sc.report.Rmd*). Modify this file to fit your custom parameter and thresholds and render it to your final html report. The Rmd file uses, among others, the following methods and packages:
  - QC: the [scater](http://bioconductor.org/packages/release/bioc/html/scater.html) package.
  - normalization: the [scran](http://bioconductor.org/packages/release/bioc/html/scran.html) package.
  - clustering: the [SC3](http://bioconductor.org/packages/release/bioc/html/SC3.html), [igraph](https://igraph.org/r/) and [stats](https://stat.ethz.ch/R-manual/R-devel/library/stats/html/00Index.html) packages.
  - marker gene detection per cluster: findMarkers function of the [scran](http://bioconductor.org/packages/release/bioc/html/scran.html) package.
  - cell type annotation with [SingleR](http://bioconductor.org/packages/release/bioc/html/SingleR.html).
  - gene set enrichment analysis on the marker genes defining each cluster: goana function from [limma](https://bioconductor.org/packages/release/bioc/html/limma.html) package.
  - differential expression analysis between sample groups using pseudo bulking: the [edgeR](https://www.bioconductor.org/packages/release/bioc/html/edgeR.html) package.

### Pipeline parameter settings
- essential.vars.groovy: essential parameter describing the experiment 
  - ESSENTIAL_PROJECT: your project folder name.
  - ESSENTIAL_SAMPLE_PREFIX: common sample prefix to be removed from output plots.
  - ESSENTIAL_STAR_REF / ESSENTIAL_TENX_TRANSCRIPTOME: path to STAR indexed /cellranger reference genome.
  - ESSENTIAL_ORG: UCSC organism name.
  - ESSENTIAL_DB: UCSC assembly version
  - ESSENTIAL_GENESGTF: path to gtf file containing genome annotation.
  - ESSENTIAL_MTGENES: filename with list of gene_ids of mitochondrial genes (give path within ESSENTIAL_PROJECT). If not given (empty string), all genes annotated on the mitochondrial chromosome are used by default.
  - ESSENTIAL_PAIRED: either paired end ("yes") or single read ("no") design ("no" for MARS-Seq and 10X, because R2 in MARS_Seq and R1 in 10X contain UMI and barcodes only).
  - ESSENTIAL_STRANDED: strandness of library (no|yes|reverse).
  - ESSENTIAL_READLENGTH: read length of library.
  - ESSENTIAL_THREADS: number of threads for parallel tasks.
  - ESSENTIAL_ADAPTER_SEQUENCE: (optional) adapter sequence to be trimmed if RUN_CUTADAPT=true.
  - ESSENTIAL_NEXTSEQTRIM: most Illumina instruments use a two-color chemistry like the NextSeq (exceptions: MiSeq, HiSeq). This option accounts for terminal G bases incorporated by faulty dark cycles during base quality trimming with cutadapt.
  - ESSENTIAL_BCPATTERN: (optional) barcode and UMI pattern as it is present in MARS-Seq data.
- additional (more specialized) parameter can be given in the header files of the individual pipeline modules (see module header files linked in the flowchart for default parameter). 


- targets.txt: tab-separated txt-file giving information about the analyzed samples. The following columns can be provided:
  - sample: (required) shortened sample identifier to be used in plots. 
  - file: (required) file name identifier. Must be a unique substring of the corresponding input sample file name, e.g. full sample name with filetype suffixes removed (the sample name itself must not contain dots). 
  - group: (required) default variable for cell grouping (e.g. by condition). You can provide additional grouping variables optionally.
  - replicate: (required) define sample replicates within groups.
  - plate: (for plate-based pipelines only) plate ID (number).
  - row: (for plate-based pipelines only) plate row (letter).
  - col: (for plate-based pipelines only) late column (number).
  - cells: (for plate-based pipelines only) number of cells per well (one of "0c", "1c", "10c" with "0c" and "10c" being control wells).
  - pool: (for plate-based and pooled libraries like MARS-seq only) the pool ID comprises all cells from 1 library pool (i.e. a set of unique cell barcodes; the cell barcodes are re-used in other pools). Must be a unique substring of the input sample file name. For pool-based design, the pool ID is grebbed against the respective count data filename instead of the sample name as stated above.
  - barcode: (for plate-based and pooled libraries like MARS-seq only) cell barcodes used as cell identifier in the count files. After merging the count data with targets.txt, the barcodes are replaced with sample IDs given in the sample column (i.e. here, sample names need not be a substring of input sample file name).

### Programs required
- FastQC
- FastQScreen
- STAR
- Cellranger (for 10X)
- Samtools
- Bedtools
- Subread
- Picard
- UCSC utilities
- RSeQC
- UMI-tools
- R

## Resources
- [Orchestrating Single-Cell Analysis with Bioconductor](http://bioconductor.org/books/release/OSCA/)
- Trajectory analysis (pseudotime): the [monocle](https://bioconductor.org/packages/release/bioc/html/monocle.html) package.
- A [tutorial](https://scrnaseq-course.cog.sanger.ac.uk/website/index.html) from Hemberg lab
- Luecken and Theis 2019 [Current best practices in single‐cell RNA‐seq analysis: a tutorial](https://www.embopress.org/doi/10.15252/msb.20188746)
- How to estimate required [cell numbers](https://satijalab.org/howmanycells)
